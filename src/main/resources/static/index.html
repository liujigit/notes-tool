<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <title>sdk issues</title>
    <style>

        html,body {
            width: 100%;
            height: 100%;
            padding: 0;
        }
        #vditor {
            width: 100%;
            height: 100%;
            padding: 0;
            margin-top: 2rem;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/vditor@3.9.8/dist/index.css" />
    <script src="https://unpkg.com/vditor@3.9.8/dist/index.min.js"></script>
</head>
<body>
<div id="vditor"></div>
<script>
    let toolbar = ["emoji", "headings", "bold", "italic", "strike", "link", "list",
        "ordered-list", "outdent", "indent", "check", "line", "quote", "code", "inline-code", "insert-after",
        "insert-before", "upload", "record", "table"];;
    console.log(window.location.search)
    function getId() {
        const urlSearchParams = new URLSearchParams(window.location.search);
        const id = urlSearchParams.get('id');
        return id ? id : -1;
    }

    const vditor = new Vditor('vditor', {
        height: '100%',
        width: 'auto',
        mode: 'wysiwyg',  //sv, ir, wysiwyg
        lang: 'zh_CN', // zh_CN,en_US" +
        theme: 'dark', //dark、classic
        icon: 'ant', // material,ant
        placeholder: '请输入',
        toolbar: null,
        cdn: 'https://unpkg.com/vditor@3.9.8',
        outline: {
            enable: false,
            position: 'left',
        },
        value: '',
        cache: {
            enable: true,
            id: 'note-' + getId(),
        },
        debugger: false,
        typewriterMode: true,
        preview: {
            theme: {
                current: 'dark'
            },
            markdown: {
                toc: false,
                mark: false,
                footnotes: true,
                autoSpace: true,
            },
            math: {
                engine: 'KaTeX',
            },
        },
        toolbarConfig: {
            pin: true,
        },
        counter: {
            enable: true,
            type: 'text',
        },
        tab: '\t',
    });

    function setValue(value){
        console.log("setValue:"+value);
        vditor.setValue(value);
    }


    function removeNoteCache(id) {
        console.log("removeNoteCache");
        window.noteQuery({
            request: 'removeNoteContent:'+id,
            persistent: false,
            onSuccess: function(response) {
                return response;
            },
            onFailure: function(error_code, error_message) {
                console.log("error_message removeNoteCache:" + error_message);
            }
        })
    }

    function getNoteCache(id) {
        console.log("getNoteCache");
        try {
            window.noteQuery({
                request: 'getNote:'+id,
                persistent: false,
                onSuccess: function(response) {
                   setValue(response)
                },
                onFailure: function(error_code, error_message) {
                    console.log("error_message getNoteCache:" + error_message);
                }
            })
        }catch(err) {
            console.log(err);
        }
    }

    function setNoteCache(id,content) {
        console.log("setNoteCache");
        window.noteQuery({
            request: 'setNote:'+id+"-:"+content,
            persistent: false,
            onSuccess: function(response) {
                console.log(response);
            },
            onFailure: function(error_code, error_message) {
                console.log("error_message setNoteCache:" + error_message);
            }
        })
    }


</script>
</body>
</html>